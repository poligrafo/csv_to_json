# 221003 - Скрипт по преобразованию CSV в JSON

### Задача

Нужен скрипт, который будет один или несколько csv-файлов преобразовывать в аналогично именованные json-файлы установленного формата.

### Пример CSV (входные данные)

| id | name | active | 238 кол-во зон нагрева | 54 управление | 83 темп режим мин | 83 темп режим макс |
| --- | --- | --- | --- | --- | --- | --- |
| 2934 | Название первого товара | 1 | 4 | Механическое | 50 | 270 |
| 5612 | Название второго товара | 1 | 2 | Механическое | 50 | 270 |
| 945 | Название третьего товара | 0 | 4 | Электромеханическое | 60 | 300 |

[attributes_2_0.csv](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/0b01eba2-bc45-43dc-aa9f-38981b9ccec7/attributes_2_0.csv)

### Требуемый результат в JSON

```json
{
    "product_attrs": [
        {
            "id": "2934",
            "name": "Название первого товара",
            "active": "1",
            "attributes": {
                "238": "4",
                "54": "Механическое",
                "83": {
                    "min": "50",
                    "max": "270"
                }
            }
        },
        {
            "id": "5612",
            "name": "Название второго товара",
            "active": "1",
            "attributes": {
                "238": "2",
                "54": "Механическое",
                "83": {
                    "min": "50",
                    "max": "270"
                }
            }
        },
        {
            "id": "945",
            "name": "Название третьего товара",
            "active": "0",
            "attributes": {
                "238": "4",
                "54": "Электромеханическое",
                "83": {
                    "min": "60",
                    "max": "300"
                }
            }
        }
    ]
}
```

[attributes_2_0.json](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a02c6bd6-36db-4d7e-a664-52cc0627b404/attributes_2_0.json)

### Детали

Атрибуты бывают разных типов (есть выгруженная в JSON таблица БД). Нужно делать проверку, если `range`, то к атрибуту добавляется запись из двух строк с ключами `min` и `max`. В остальных случаях в записи `attributes` записывается простая строка из ключа — ID атрибута и его значения.

Во входной таблице заголовки столбцов с атрибутами будут состоять из ID и названия атрибута, например «54 управление», но в JSON должны попадать только ID, поэтому стоит предусмотреть механизмя отсечения текстовой части заголовка.

**JSON с типами атрибутов (выгрузка из БД)**

[attributes_from_db.json](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/f584d604-bb31-48a5-a840-12c6aab98fa6/attributes_from_db.json)

### Примерный алгоритм

Скрипт смотрит, есть ли в его директории папка CSV с набором файлов и дальше по очереди обрабатывает таблицы, складывая в папку JSON результат.

Для каждого столбца с атрибутами (4-й и последующие) получается из заголовка ID атрибута, проверяется его тип и в зависимости от типа записывается соответствующая строка или в запись `attributes`.
